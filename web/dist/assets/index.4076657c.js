import{w as C,t as s,r as o,F as S,U as a,a as R,j as E,b as t,I as D,M as A,q as U,k as $,f as B,bO as q}from"./index.d8d91588.js";import{d as V,P as H}from"./pagination.891d4a84.js";import{a as I,E as K,b as X,c as z,A as J,S as Q,T as W}from"./pem_check.3e14cc85.js";import"./index.ec907f20.js";import"./iconUtil.3e86a04f.js";import"./index.93d02781.js";import"./PlusOutlined.16a4ec92.js";const Y={base:{prefix:"activity/exam",endpoints:{crud:""}}},b=C.prefixMapValues(Y.base),F=s.exports.t`Bài thi`,w=F.toLowerCase(),L={name:w,heading:F,deleteOne:s.exports.t`Bạn có muốn xoá ${w} này?`,deleteMultiple:s.exports.t`Bạn có muốn xoá những ${w} này?`},m={member:s.exports.t`Người thi`,contest:s.exports.t`Cuộc thi`,score:s.exports.t`Điểm số`,pass:s.exports.t`Đạt`,submitted_at:s.exports.t`Giờ nộp`,started_at:s.exports.t`Giờ làm bài`,finished_at:s.exports.t`Giờ kết thúc`},N="ExamForm",Z={id:0,uid:"",value:""};function T({data:f,onChange:p}){const n=o.exports.useRef(null),[l]=S.useForm(),d=a.isEmpty(f)?Z:f,u=d.id,x=u?`${b.crud}${u}`:b.crud,h=u?"put":"post",i={uid:{name:"uid",label:m.uid,rules:[R.ruleRequired()]},value:{name:"value",label:m.value}};return o.exports.useEffect(()=>{n.current.focus({cursor:"end"})},[]),E(S,{form:l,name:N,labelCol:{span:6},wrapperCol:{span:18},initialValues:{...d},onFinish:c=>R.submit(x,c,h).then(k=>p(k,u)).catch(R.setFormErrors(l)),children:[t(S.Item,{...i.uid,children:t(D,{ref:n})}),t(S.Item,{...i.value,children:t(D,{})})]})}T.displayName=N;T.formName=N;class y{static get toggleEvent(){return"TOGGLE_EXAM_DIALOG"}static toggle(p=!0,n=0){a.event.dispatch(y.toggleEvent,{open:p,id:n})}}function v({onChange:f}){const[p,n]=o.exports.useState({}),[l,d]=o.exports.useState(!1),[u,x]=o.exports.useState(0),h=({detail:{open:i,id:c}})=>{if(!i)return d(!1);x(c),c?(a.toggleGlobalLoading(),C.apiCall(`${b.crud}${c}`).then(k=>{n(k),d(!0)}).finally(()=>a.toggleGlobalLoading(!1))):(n({}),d(!0))};return o.exports.useEffect(()=>(a.event.listen(y.toggleEvent,h),()=>{a.event.remove(y.toggleEvent,h)}),[]),t(A,{keyboard:!1,maskClosable:!1,destroyOnClose:!0,open:l,okButtonProps:{form:T.formName,key:"submit",htmlType:"submit"},okText:s.exports.t`Save`,onCancel:()=>y.toggle(!1),cancelText:s.exports.t`Cancel`,title:a.getDialogTitle(u,L),children:t(T,{data:p,onChange:(i,c)=>{d(!1),f(i,c)}})})}v.displayName="ExamDialog";v.toggle=y.toggle;const G="exam";function M(){const[f,p]=o.exports.useState(!0),[n,l]=o.exports.useState([]),[d,u]=o.exports.useState([]),[x,h]=o.exports.useState(V),i=(e=!0)=>(r="",g={})=>{e&&a.toggleGlobalLoading(),C.apiCall(r||b.crud,g).then(_=>{h(_.links),l(a.appendKey(_.items))}).finally(()=>{p(!1),e&&a.toggleGlobalLoading(!1)})};function c(e){i()("",e?{search:e}:{})}o.exports.useEffect(()=>{i(!1)()},[]);function k(e){!window.confirm(L.deleteOne)||(a.toggleGlobalLoading(!0),C.apiCall(`${b.crud}${e}`,{},"delete").then(()=>{l([...n.filter(g=>g.id!==e)])}).finally(()=>a.toggleGlobalLoading(!1)))}function O(e){!window.confirm(L.deleteMultiple)||(a.toggleGlobalLoading(!0),C.apiCall(`${b.crud}?ids=${e.join(",")}`,{},"delete").then(()=>{l([...n.filter(g=>!e.includes(g.id))])}).finally(()=>a.toggleGlobalLoading(!1)))}function P(e,r){if(!r)l([{...e,key:e.id},...n]);else{const g=n.findIndex(_=>_.id===r);e.key=e.id,n[g]=e,l([...n])}}const j=[{key:"member",title:m.member,dataIndex:["member_obj","label"]},{key:"contest",title:m.contest,dataIndex:["contest_obj","label"]},{key:"score",title:m.score,dataIndex:"score"},{key:"start_at",title:m.started_at,dataIndex:"started_at",render:e=>a.isoToReadableDatetimeStr(e)},{key:"finish_at",title:m.finished_at,dataIndex:"finished_at",render:e=>a.isoToReadableDatetimeStr(e)},{key:"submitted_at",title:m.submitted_at,dataIndex:"submitted_at",render:e=>a.isoToReadableDatetimeStr(e)},{key:"action",title:"",fixed:"right",width:90,render:(e,r)=>E("div",{className:"flex-space",children:[t(I,{pem_group:G,pem:"change",children:t(K,{onClick:()=>v.toggle(!0,r.id)})}),t(I,{pem_group:G,pem:"delete",children:t(X,{onClick:()=>k(r.id)})})]})}];return E("div",{children:[E(U,{children:[t($,{span:12,children:t(I,{pem_group:G,pem:"delete",children:t(z,{ids:d,onClick:O})})}),t($,{span:12,className:"right",children:t(I,{pem_group:G,pem:"add",children:t(J,{onClick:()=>v.toggle()})})})]}),t(Q,{onChange:c}),t(W,{rowSelection:{type:"checkbox",...{onChange:e=>{u(e)}}},columns:j,dataSource:n,loading:f,scroll:{x:1e3},pagination:!1}),t(H,{next:x.next,prev:x.previous,onChange:i()}),t(v,{onChange:P})]})}M.displayName="ExamTable";function ee(){return E(B,{children:[t(q,{children:t(B,{children:L.heading})}),t(M,{})]})}ee.displayName="Exam";export{ee as default};
