import{r as a,b as e,A as z,w as O,t as k,R as V,F as d,c as H,U as n,a as B,j as b,f as G,y as K,I as q,B as W,bw as A,M as J,d as X,q as Y,k as P,bO as Z}from"./index.d8d91588.js";import{d as ee,P as te}from"./pagination.891d4a84.js";import{C as ne,a as T,E as oe,b as se,c as ie,A as ae,S as le,T as re}from"./pem_check.3e14cc85.js";import{T as ce}from"./select_input.a4e8b1c9.js";import{P as ue}from"./PlusOutlined.16a4ec92.js";import"./index.ec907f20.js";import"./iconUtil.3e86a04f.js";import"./index.93d02781.js";var de={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const pe=de;var me=function(i,l){return e(z,{...i,ref:l,icon:pe})};const ge=a.exports.forwardRef(me);function he({value:p,onChange:i}){return e(ne,{checked:p,onChange:l=>{i(l.target.checked)}})}const fe={base:{prefix:"activity/question",endpoints:{crud:""}}},I=O.prefixMapValues(fe.base),F=k.exports.t`Câu hỏi`,D=F.toLowerCase(),R={name:D,heading:F,deleteOne:k.exports.t`Bạn có muốn xoá ${D} này?`,deleteMultiple:k.exports.t`Bạn có muốn xoá những ${D} này?`},_={content:k.exports.t`Nội dung`,type:k.exports.t`Loại câu hỏi`},Q=V({key:"questionOptions",default:{type:[]}}),{TextArea:xe}=q,N="QuestionForm",ye={id:0,uid:"",value:""};function $({contestId:p,data:i,onChange:l}){const o=a.exports.useRef(null),[r]=d.useForm(),m=H(Q),v=n.isEmpty(i)?ye:i,u=v.id,E=u?`${I.crud}${u}`:I.crud,x=u?"put":"post",s={content:{name:"content",label:_.content,rules:[B.ruleRequired()]},type:{name:"type",label:_.type},answers:{name:"answersWrapper",label:"C\xE2u tr\u1EA3 l\u1EDDi"}};return a.exports.useEffect(()=>{o.current.focus({cursor:"end"})},[]),b(d,{form:r,name:N,labelCol:{span:6},wrapperCol:{span:18},initialValues:{...v},onFinish:y=>{const g={...y};g.answers=g.answers.map(h=>({content:h.content,correct:!!h.correct})),console.log(g),B.submit(E,{...g,contest:p},x).then(h=>l(h,u)).catch(B.setFormErrors(r))},children:[e(d.Item,{...s.content,children:e(xe,{ref:o})}),e(d.Item,{...s.type,children:e(ce,{options:m.type,block:!0})}),e(d.Item,{...s.answers,children:e(d.List,{name:"answers",children:(y,{add:g,remove:h})=>b(G,{children:[y.map(f=>e("div",{children:b(K,{align:"baseline",children:[e(d.Item,{...f,name:[f.name,"content"],rules:[{required:!0,message:"Thi\u1EBFu n\u1ED9i dung"}],children:e(q,{})}),e(d.Item,{...f,name:[f.name,"correct"],children:e(he,{})}),e(ge,{onClick:()=>h(f.name)})]})},`question${f.key}`)),e(d.Item,{children:e(W,{type:"dashed",onClick:()=>g(),block:!0,icon:e(ue,{}),children:"Th\xEAm c\xE2u tr\u1EA3 l\u1EDDi"})})]})})})]})}$.displayName=N;$.formName=N;class w{static get toggleEvent(){return"TOGGLE_QUESTION_DIALOG"}static toggle(i=!0,l=0){n.event.dispatch(w.toggleEvent,{open:i,id:l})}}function L({onChange:p}){const{contestId:i}=A(),[l,o]=a.exports.useState({}),[r,m]=a.exports.useState(!1),[v,u]=a.exports.useState(0),E=({detail:{open:x,id:s}})=>{if(!x)return m(!1);u(s),s?(n.toggleGlobalLoading(),O.apiCall(`${I.crud}${s}`).then(y=>{o(y),m(!0)}).finally(()=>n.toggleGlobalLoading(!1))):(o({}),m(!0))};return a.exports.useEffect(()=>(n.event.listen(w.toggleEvent,E),()=>{n.event.remove(w.toggleEvent,E)}),[]),e(J,{keyboard:!1,maskClosable:!1,destroyOnClose:!0,open:r,okButtonProps:{form:$.formName,key:"submit",htmlType:"submit"},okText:k.exports.t`Save`,onCancel:()=>w.toggle(!1),cancelText:k.exports.t`Cancel`,width:"80%",title:n.getDialogTitle(v,R),children:e($,{contestId:i,data:l,onChange:(x,s)=>{m(!1),p(x,s)}})})}L.displayName="QuestionDialog";L.toggle=w.toggle;const M="question";function U(){const{contestId:p}=A(),[i,l]=a.exports.useState(!0),[o,r]=a.exports.useState([]),[m,v]=a.exports.useState([]),[u,E]=a.exports.useState(ee),x=X(Q),s=(t=!0)=>(c="",C={})=>{t&&n.toggleGlobalLoading(),O.apiCall(c||I.crud,{...C,contest:p}).then(S=>{E(S.links),r(n.appendKey(S.items)),x(S.extra.options)}).finally(()=>{l(!1),t&&n.toggleGlobalLoading(!1)})};function y(t){s()("",t?{search:t}:{})}a.exports.useEffect(()=>{s(!1)()},[]);function g(t){!window.confirm(R.deleteOne)||(n.toggleGlobalLoading(!0),O.apiCall(`${I.crud}${t}`,{},"delete").then(()=>{r([...o.filter(C=>C.id!==t)])}).finally(()=>n.toggleGlobalLoading(!1)))}function h(t){!window.confirm(R.deleteMultiple)||(n.toggleGlobalLoading(!0),O.apiCall(`${I.crud}?ids=${t.join(",")}`,{},"delete").then(()=>{r([...o.filter(C=>!t.includes(C.id))])}).finally(()=>n.toggleGlobalLoading(!1)))}function f(t,c){if(!c)r([{...t,key:t.id},...o]);else{const C=o.findIndex(S=>S.id===c);t.key=t.id,o[C]=t,r([...o])}}const j=[{key:"content",title:_.content,dataIndex:"content"},{key:"type",title:_.type,dataIndex:["type_obj","label"],width:150},{key:"action",title:"",fixed:"right",width:90,render:(t,c)=>b("div",{className:"flex-space",children:[e(T,{pem_group:M,pem:"change",children:e(oe,{onClick:()=>L.toggle(!0,c.id)})}),e(T,{pem_group:M,pem:"delete",children:e(se,{onClick:()=>g(c.id)})})]})}];return b("div",{children:[b(Y,{children:[e(P,{span:12,children:e(T,{pem_group:M,pem:"delete",children:e(ie,{ids:m,onClick:h})})}),e(P,{span:12,className:"right",children:e(T,{pem_group:M,pem:"add",children:e(ae,{onClick:()=>L.toggle()})})})]}),e(le,{onChange:y}),e(re,{rowSelection:{type:"checkbox",...{onChange:t=>{v(t)}}},columns:j,dataSource:o,loading:i,scroll:{x:1e3},pagination:!1}),e(te,{next:u.next,prev:u.previous,onChange:s()}),e(L,{onChange:f})]})}U.displayName="QuestionTable";function Ce(){return b(G,{children:[e(Z,{children:e(G,{children:R.heading})}),e(U,{})]})}Ce.displayName="Question";export{Ce as default};
